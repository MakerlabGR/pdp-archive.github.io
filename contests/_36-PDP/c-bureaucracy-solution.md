---
layout: solution
codename: bureaucracy
---

## Επεξήγηση εκφώνησης

Έχουμε έναν κατευθυνόμενο γράφο $$N$$ κόμβων με ακμές που έχουν βάρη. Κάποιοι κόμβοι έχουν οριστεί ως αρχικοί $$S$$ και 
κάποιοι κόμβοι ως τελικοί $$D$$. Ας υποθέσουμε ότι ξεκινάμε από έναν αρχικό κόμβο $$S_i$$ για να φτάσουμε σε έναν τελικό 
κόμβο $$D_j$$ και στο μονοπάτι που ακολουθούμε το μέγιστο βάρος που θα συναντήσουμε το ονομάζουμε $$L_j$$ και τον αριθμό των ακμών που θα προσπεράσουμε τον ονομάζουμε $$C_j$$. 

Για να φτάσουμε στον κόμβο $$D_j$$ μπορούμε να ξεκινήσουμε από όποιον αρχικό κόμβο $$S_i$$ θέλουμε αρκεί να υπάρχει μονοπάτι από τον $$S_i$$ προς τον $$D_j$$. Σύμφωνα με την εκφώνηση, υπάρχει μονοπάτι που καταλήγει σε κάθε τελικό κόμβο ξεκινώντας από κάποιον ή κάποιους αρχικούς. 

Ζητείται να φτάσουμε σε *όλους* τους τελικούς κόμβους με το ελάχιστο δυνατό $$L$$ (δηλαδή το μέγιστο βάρος ακμής από όλα τα μονοπάτια που ακολουθήσαμε). Επιπλέον, για το ελάχιστο αυτό $$L$$, να υπολογίσουμε πόσες ακμές συνολικά προσπεράσαμε.  

## Βέλτιστη λύση με δυαδική αναζήτηση και αναζήτηση κατά πλάτος

**Παρατήρηση 1:** Έστω ότι ορίσουμε ως $$L_{limit}$$ το μέγιστο βάρος των ακμών που επιτρέπετε να διανύσουμε  στην προσπάθεια μας να φτάσουμε από τους αρχικούς κόμβους σε όλους τους τελικούς κόμβους. Προφανώς όσες ακμές έχουν βάρος μεγαλύτερο από $$L_{limit}$$ θεωρούνται απαγορευμένες. Αν μηδενίσουμε το $$L_{limit}$$ τότε θα απαγορευτούν όλες οι ακμές και δεν θα καταφέρουμε να φτάσουμε στους τελικούς κόμβους.  
Όσο αυξάνουμε το $$L_{limit}$$ επιτρέπουμε περισσότερες ακμές μέχρι που σε κάποια οριακή τιμή του (και σε όλες τις μεγαλύτερες τιμές), θα καταφέρουμε να φτάσουμε σε όλους τους τελικούς κόμβους. Η αναζήτηση της οριακής αυτής τιμής γίνεται με **δυαδική αναζήτηση** στα δυνατά $$L_{limit}$$ δηλαδή στα βάρη των ακμών που μας δίνονται.    

**Παρατήρηση 2:** Έστω ότι επιθυμούμε να δοκιμάσουμε μια τιμή $$L_{limit}$$ και θέλουμε να ελέγξουμε αν είναι εφικτό να φτάσουμε σε όλους τους τελικούς κόμβους. Θέλουμε μάλιστα να βρούμε ένα μονοπάτι από κάποιον αρχικό κόμβο σε κάθε τελικό κόμβο. Η αναζήτηση με μέτρηση ακμών είναι η **αναζήτηση κατά πλάτος (BFS)** την οποία μπορείτε να δείτε ([εδώ](https://el.wikipedia.org/wiki/Αναζήτηση_κατά_πλάτος)) και ([εδώ](https://cp-algorithms.com/graph/breadth-first-search.html)). Καθώς εξερευνούμε το γράφο και βρεθήκαμε σε έναν κόμβο $$u$$, η αναζήτηση κατά πλάτος, μας δίνει τον αριθμό των ακμών που προσπεράσαμε ξεκινώντας από τον εικονικό αρχικό κόμβο μέχρι τον κόμβο $$u$$.  

**Προετοιμάζοντας τη δυαδική αναζήτηση:** Συγκεντρώνουμε όλες τις τιμές βαρών των ακμών σε έναν πίνακα $$W$$ και τις ταξινομούμε. Κατόπιν αφαιρούμε(διαγράφουμε) τα διπλότυπα ώστε να αποκτήσουμε μια γνησίως αύξουσα ακολουθία βαρών[^1] με τη χρήση της ``std::unique`` και της ``std::vector::erase``

[^1]: Η αφαίρεση των δυπλότυπων δεν είναι απαραίτητη για τη λύση του προβλήματος αλλά μειώσει τα βήματα της δυαδικής αναζήτησης υπό προϋποθέσεις.

```
	std::sort(W.begin(), W.end());
	W.erase(std::unique(W.begin(), W.end()), W.end());
```

**Μειώνοντας τον αριθμό των αρχικών κόμβων:** Αντί να δοκιμάσουμε αναζήτηση κατά πλάτος για ένα $$L_{limit}$$ από κάθε αρχικό κόμβο και να πρέπει να ενώσουμε τα αποτελέσματα των αναζητήσεων στο τέλος για να δούμε αν καταφέραμε να φτάσουμε σε όλους τους τελικούς κόμβους, μπορούμε 
να δημιουργήσουμε έναν εικόνικο (dummy) κόμβο που να αποτελει την αφετηρία της αναζήτησης κατά πλάτος και να προσθέσουμε dummy ακμές από αυτόν προς κάθε αρχικό κόμβο. Δεν θέλουμε οι ακμές αυτές να επηρεάζονται από το $$L_{limit}$$ οπότε οι ακμές αυτές θα έχουν βάρος $$0$$. Προφανώς θα πρέπει από κάθε μονοπάτι που θα καταλήγει σε έναν τελικό κόμβο να αφαιρέσουμε τη μια dummy ακμή που προσπεράσαμε. Οι κόμβοι στο αρχείο εισόδου είναι αριθμημένοι από $$1$$ έως $$N$$ οπότε χρησιμοποιούμε τον κόμβο $$0$$ ως τον νέο εικονικό αρχικό κόμβο. 

```
	for(long i=0,s; i<Snr /*αριθμός αρχικών κόμβων*/; i++){
		fscanf(in, "%ld", &s);
		edge[0].push_back( { 0/*βάρος*/, s/*προορισμός*/ } );
	}
```
 
**Μετρώντας τους τελικους κόμβους που εξερευνήσαμε:** Κατά την εκτέλεση της αναζήτησης κατά πλάτος, κάθε φορά που φτάνουμε σε έναν κόμβο ελέγχουμε αν είναι τελικός κόμβος και αν είναι, αυξάνουμε έναν μετρητή. Αν καταλήξουμε να μετρήσουμε όλους τους τελικούς μας κόμβους, η τιμή $$L_{limit}$$ ήταν ικανοποιητική.

Ο χρόνος που απαιτεί ο αλγόριθμος μας καθορίζεται από τη δυαδική αναζήτηση στις $$R$$ ακμές που μπορούν να παράγουν το πολύ $$R$$ διακριτές τιμές βάρους και την αναζήτηση κατά πλάτος που θα εξετάσει $$R$$ ακμές και απαιτεί χρόνο $$\mathcal{O}(R)$$. Ο συνολικός χρόνος που απαιτείται είναι $$\mathcal{O}(R\cdot \log{R})$$

{% include code.md solution_name='bsearch_RlogR.cc' %}
    