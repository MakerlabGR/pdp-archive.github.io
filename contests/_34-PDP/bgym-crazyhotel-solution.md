---
layout: solution
codename: crazyhotel
---

## Επεξήγηση εκφώνησης

Μας δίνεται πίνακας $$A$$ με $$N$$ μη αρνητικές τιμές $$A_i$$ (το κόστος διαμονής της ημέρας $$i$$) και δύο τιμές ακόμα, η $$S$$ που αναπαριστά το μέγιστο επιτρεπτό άθροισμα και η $$T$$ που αναπαριστά το μέγιστο όριο επιλέξιμων αριθμών. 
Ζητείται να βρούμε το σύνολο των δυνατών συνδυασμών αθροισμάτων συνεχόμενων επιλέξιμων αριθμών που όμως δεν υπερβαίνουν το $$S$$.

**Παρατήρηση 1:** Έστω ότι έχουμε $$k$$ συνεχόμενους αριθμούς $$A_i,A_{i+1},A_{i+2},...,A{i+k-1}$$ που το άθροισμα τους δεν ξεπερνά το $$S$$ και κανένας εξ' αυτών δεν έχει τιμή που να ξεπερνά το $$T$$. Αυτοί οι $$k$$ αριθμοί, έχουν ακριβώς $$k$$ συνδυασμούς διαστημάτων συνεχόμενων αριθμών που να περιλαμβάνουν το $$A_i$$. Αυτοί οι συνδυασμοί είναι:  
$$A_i$$  
$$A_i + A_{i+1}$$  
$$A_i + A_{i+1} + A_{i+2}$$  
$$A_i + A_{i+1} + A_{i+2} + A_{i+3}$$  
...  
$$A_i + A_{i+1} + A_{i+2} + A_{i+3} + ... + A_{i+k-1}$$  

Οπότε αρκεί σε κάθε θέση $$\mathit{left}$$, με $$1 \le \mathit{left} \le N$$, να βρεθεί η μεγαλύτερη θέση $$\mathit{right}$$ ($$\mathit{left}
\le \mathit{right} \le N$$), ώστε το άθροισμα όλων των στοιχείων $$A_\mathit{left} + A_{\mathit{left}+1} + ... + A_{\mathit{right}-1} + A_{\mathit{right}} \le S$$ και κανένας από αυτούς τους αριθμούς να μην υπερβαίνει το $$T$$.

## Μη αποδοτική λύση brute force. Πολυπλοκότητα $$\mathcal{O}(N^2)$$.

Για κάθε θέση $$\mathit{left}$$ εκτελούμε ένα βρόγχο *while* ώστε να βρούμε τη θέση $$\mathit{right}$$. Αθροίζουμε τα πλήθη όλων των
διαστημάτων $$[\mathit{left},\mathit{right}]$$ που ικανοποιούν τους περιορισμούς των $$S$$ και $$T$$.

{% include code.md solution_name='crazyhotel_brute.cpp' start=15 end=22 %}

## Βέλτιστη λύση με χρήση δύο δεικτών (two pointers). Πολυπλοκότητα $$\mathcal{O}(N)$$.

Η θέση $$\mathit{left}$$ αυξάνεται κατά $$1$$ σε κάθε επανάληψη του εξωτερικού *for* μέχρι να προσπελάσει ολόκληρο τον πίνακα. 
Η θέση $$\mathit{right}$$ αντιστοιχεί στη μεγαλύτερη θέση του πίνακα όπου $$\sum_{i=\mathit{left}}^\mathit{right} {A_i} \leq S$$ και
κανένα στοιχείο του διαστήματος δεν υπερβαίνει το $$T$$. 
Στην επόμενη επανάληψη, το $$[\mathit{left},\mathit{right}]$$ θα συρρικνωθεί από αριστερά, στο $$[\mathit{left}+1,\mathit{right}]$$ και καθώς το
$$A_\mathit{left}$$ που έφυγε από το επιλεγμένο διάστημα, ήταν μη αρνητικός αριθμός, το άθροισμα του συρρικνωμένου διαστήματος δεν θα μεγαλώσει.
Καθώς το $$\mathit{left}$$ μετακινείται λοιπόν προς τα δεξιά, το $$\mathit{right}$$ θα μετακινείτε και αυτό προς τα δεξιά, όσο και αν χρειαστεί,
ώστε να βρούμε τη νέα μέγιστη θέση και να συνεχίσουν να ισχύουν οι περιορισμοί του $$S$$ και $$T$$.

Η τεχνική αυτή χρησιμοποιεί τους δύο pointers $$\mathit{left}, \mathit{right}$$ για να βρει όλα τα διαστήματα που μας ενδιαφέρουν στον πίνακα.
Σε κάθε αύξηση του αριστερού pointer, ο δεξιός μπορεί να κάνει έως $$N$$ βήματα. Όμως για όλες τις $$N$$ συνολικά αυξήσεις του αριστερού pointer, o δεξιός θα κάνει και αυτός συνολικά $$N$$ αυξήσεις οπότε η πολυπλοκότητα είναι $$\mathcal{O}(N)$$.

Για τον υπολογισμό των αθροισμάτων του διαστήματος $$[\mathit{left},\mathit{right}]$$ μπορούν να χρησιμοποιηθούν τα prefix sums (ή cumulative sums) όπως στον παρακάτω κώδικα:

{% include code.md solution_name='crazyhotel_sliding_ps.cpp' start=17 end=25 %}

ή το άθροισμα να υπολογίζεται δυναμικά (on the fly):

{% include code.md solution_name='crazyhotel_sliding_v2.cpp' start=16 end=27 %}

Υπάρχει μια ακόμα λύση με χρήση των δύο pointers που αξιοποιεί το άθροισμα όρων αριθμητικής προόδου για να βρει όλους τους συνδυασμούς
συνεχόμενων διαστημάτων ανάμεσα σε $$k$$ τιμές. Στον υπολογισμό αυτό υπάρχουν $$k$$ μονές τιμές, $$k-1$$ ζεύγη, $$k-2$$ τριάδες, ..., $$1$$ $$k$$-άδα. 
Άρα έχουμε μια αριθμητική ακολουθία $$k$$ όρων με πρώτο όρο το $$1$$, τελευταίο το $$k$$ και βήμα $$1$$. Το άθροισμα μας το δείνει ο τύπος $$\frac{k\dot (k+1)}{2}$$
Προσοχή χρειάζεται μόνο κατά την επικάλυψη δύο τμημάτων όπου το κοινό διάστημα θα μετρηθεί δύο φορές οπότε πρέπει να το αφαιρέσουμε.

{% include code.md solution_name='crazyhotel_sliding_segsum.cpp' start=11 end=27 %}


## Λύση με δυαδική αναζήτηση. Πολυπλοκότητα $$\mathcal{O}(N\dot \log {N} )$$.

Καθώς οι τιμές του πίνακα είναι μη αρνητικές, ο πίνακας των prefix sum έχει αύξουσα διάταξη. Χρησιμοποιώντας το prefix sum μπορούμε να βρούμε ξεκινώντας από μια θέση $$\mathit{left}$$ τη μεγαλύτερη θέση $$\mathit{pos}$$, όπου το prefix sum δεν θα αυξηθεί περισσότερο από $$S$$.

{% include code.md solution_name='crazyhotel_nlogn.cpp' start=12 end=31 %}

ή με ένα τρικ κατά τη δημιουργία των prefix sum ώστε το $$T$$ να γίνει $$S+1$$ ώστε η binary search να μην συμπεριλάβει ποτέ τέτοιο σημείο.

{% include code.md solution_name='crazyhotel_nlogn_v2.cpp' start=28 end=41 %}


