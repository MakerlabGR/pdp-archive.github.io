---
layout: solution
codename: chemicals
---

## Επεξήγηση εκφώνησης

Μας δίνεται ένας πίνακας $$A$$ από $$N$$ ακεραίους αριθμούς και ένας ακέραιος αριθμός $$K$$. Μας ζητείται να βρούμε το μήκος του μεγαλύτερου διαστήματος $$[i, j]$$ ώστε να μην υπαρχει ζεύγος $$s, t$$ στο $$[i, j]$$ με άθροισμα $$A[s] + A[t]$$ που να είναι πολλαπλάσιο του $$K$$.

## Brute force $$\mathcal{O}(N^4)$$

Υπάρχουν συνολικά $$\mathcal{O}(N^2)$$ διαστήματα $$[i, j]$$ και κάθε διάστημα έχει το πολύ $$\mathcal{O}(N^2)$$ ζευγάρια. Επομένως, μπορούμε να ελέγξουμε ένα ένα τα διαστήματα συνολικά σε $$\mathcal{O}(N^4)$$ χρόνο. 

{% include code.md solution_name='brute_force_n4.cc' %}

## Brute force $$\mathcal{O}(N^3)$$

Μπορούμε να επιταγχύνουμε την παραπάνω λύση ως εξής: ξέροντας ότι το διάστημα $$[i, j-1]$$ δεν έχει κάποιο ζευγάρι που να είναι πολλαπλάσιο του $$K$$, τότε για το διάστημα $$[i, j]$$ αρκεί να ελέγξουμε ότι τα ζευγάρια $$(i, j), (i+1, j), \ldots, (j-2, j), (j-1, j)$$ έχουν ζευγάρια που δεν είναι πολλαπλάσια του $$K$$. Επειδή υπάρχουν το πολύ $$\mathcal{O}(N)$$ ζευγάρια με το $$j$$, ο αλγόριθμος παίρνει συνολικά $$\mathcal{O}(N^3)$$ χρόνο.

{% include code.md solution_name='brute_force_n3.cc' start=18 end=32 %}

Ολόκληρος ο κώδικας είναι [εδώ]({% include link_to_source.md solution_name='brute_force_n3.cc' %}).

## Brute force με hash set $$\mathcal{O}(N^2)$$

Mπορούμε να επιταγχύνουμε περαιτέρω την παραπάνω λύση, κάνοντας την εξής παρατήρηση:

**Παρατήρηση:** Δύο στοιχεία $$A[s]$$ και $$A[t]$$ έχουν άθροισμα πολλαπλάσιο του $$K$$ αν και μόνο αν $$A[s] \equiv (K - A[t]) \pmod{K}$$. 

*(Αιτιολόγηση)* Μπορούμε να ελέγξουμε ότι $$A[s] + A[t]$$ είναι πολλαπλάσιο του $$K$$, καθότι $$(A[s] + A[t]) \equiv ((K - A[t]) + A[t]) \equiv 0 \pmod{K}$$.

Επομένως, διατηρώντας σε ένα hash set $$S$$ τα στοιχεία $$A[i], \ldots, A[j-1]$$, μπορούμε να ελέγξουμε γρήγορα αν το στοιχείο $$A[j]$$ συμμετέχει σε κάποια δυάδα με άθροιμα $$A[\ell] + A[j]$$ που είναι πολλαπλάσιο του $$K$$, κοιτώντας αν υπάρχει το στοιχείο $$(K - (A[j] \% K) ) \% K$$ στο $$S$$.[^1]

[^1]: Το εσωτερικό mod χρειάζεται ώστε η διαφορά να μην βγει αρνητική.

{% include code.md solution_name='brute_hash_set_n2.cc' start=18 end=31 %}

Κάθε πρόσβαση στο hash set θέλει $$\mathcal{O}(1)$$ χρόνο, επομένως συνολικά ο αλγόριθμος θέλει $$\mathcal{O}(N^2)$$ χρόνο. Ολόκληρος ο κώδικας είναι [εδώ]({% include link_to_source.md solution_name='brute_hash_set_n2.cc' %}).

## Δύο δείκτες $$\mathcal{O}(N)$$

Γενικεύοντας την προηγούμενη λύση, μπορούμε να υπολογίσουμε για κάθε δείκτη $$j$$ το μεγαλύτερο διάστημα $$[\ell, j]$$ για το οποίο δεν υπάρχει ζεύγος $$t, s \in [\ell, j]$$ με άθροισμα $$A[s] + A[t]$$ που δεν είναι πολλαπλάσιο του $$K$$.  Έχοντας την βέλτιση λύση για το $$j-1$$ έστω $$[\ell, j-1]$$, μπορούμε να υπολογίσουμε την βέλτιση λύση για το $$j$$ μετακινώντας το $$\ell$$ έως ότου προσπεράσουμε όλα τα στοιχεία ίσα με $$(K - (A[j] \% K) ) \% K$$.

{% include code.md solution_name='two_pointers.cc' start=18 end=29 %}

Για το δεύτερο παράδειγμα, οι δύο δείκτες αλλάζουν ως εξής, δίνοντας το μέγιστο στο 5ο βήμα:

<center>
<img alt="2ο παράδειγμα για 2 δείκτες" src="/assets/35-pdp-c-chemicals.svg" width="300px">
</center>

Μπορούμε να μετακινήσουμε τον δείκτη $$\ell$$ το πολύ $$\mathcal{O}(N)$$ φορές  (δηλαδή το εσωτερικό $$\texttt{while}$$ θέλει $$\mathcal{O}(N)$$ χρόνο), επομένως ο αλγόριθμος χρειάζεται συνολικά $$\mathcal{O}(N)$$ χρόνο. Ολόκληρος ο κώδικας [εδώ]({% include link_to_source.md solution_name='two_pointers.cc' %}).
